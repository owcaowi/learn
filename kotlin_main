package com.example.githubsearchtool

import kotlinx.android.synthetic.main.activity_main.*
import android.support.v7.app.AppCompatActivity
import android.os.Bundle
import com.example.githubsearchtool.model.UserResponse
import com.github.kittinunf.fuel.httpGet

class MainActivity : AppCompatActivity() {


    val UserUrl = "https://api.github.com/users"
    var UserNames = ArrayList<UserResponse>()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        searchTool.setOnFocusChangeListener { view, b -> searchForResult(b) }
    }

    private fun searchForResult(b: Boolean) {

       if( searchTool.text == null ) return

        UserUrl.httpGet().responseObject(UserResponse.Deserializer()){ request, response, result ->
            val (users, err) = result

            users?.forEach { user ->
                UserNames.add(user)
            }

            val searchAdapter = SearchAdapter(this, android.R.layout.simple_spinner_item, UserNames)
            searchAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)
            searchDropdown!!.setAdapter(searchAdapter)

        }

    }

}


